language: node_js
node_js:
- '6'
cache:
  directories:
  - node_modules
services:
  - docker
env:
  global:
  - COMMIT=${TRAVIS_COMMIT::6}
  - secure: hPPVCYqr3a0doblwRFHc4U0A0ogCYog7XL0P+dF2VcmzwDXJLoH/5C6Tuuy2bRKLur/KakzwkcVjTDwn9cIr4p8NYI5gbxKEYlCIo6KEPgHXZJSBBOX46HJzACu6zTE/VmbtqG1a4t+eMmIWvBczfCjzhIb6OLWcHvDM76Ia5atbtbb9nAZyJaeSCOHiTI8QZtSkkCvkFM0kEbBbX7NkoakFSE0VyonSOjnXR/EWXgNJIN/k4+2dQxadusUcuJUNmJNrPMbP7RDD2ibmfPabtW6Y7W4J8KzFn6j5SD0W8J+wt+LG6nvzrj+UOd19/OVyjoINmJrfDSGbaJR/D60ijZLFWUt+ll02+sFkuNJ1/Jvfw+eBWAg4/8+P0ihl5+vpXTpJtWQNI2NlTlWXbdynbfDfhniWcL3rOL2MLQCtSlrDlfW0Zg5NP1CmpCrauL1YuymRa9NHDbwardVkhh40gbABeEWXSTBq1jlfcPAsGKseUuVOuCWd49PN6syuH2nr7stYVWbf7MvE33GhONzAa2TzhoONqaO3qlWHwG1UldNpDEqGZrmdVD35UWjlevN1WT5PYZW4PBXNoxgcQf+AoyEKs+Z4s9dmVqDL7uAYe+lRM52mDn9nIHNRmyKRzYgfRXACuV8JbfVbm/y2jY9SomB47Ia5hnFT9waYPTIqRg0=
  - secure: Tu5JnSFo2VqOWtYjXPjl/aM2Ek8i7ZnmhXYoKgUQd356R8HNKlnA3NlHSmm1z9N1ZLLuGsNao9PpCYF51RVqyfVcPsYm5ts1Tb+lZUNcd4lpYsBWtJlQkTMQ7ro57oyr8z98SQXa0oNpY29RxTzsnb2Z9PcQPpxAvLYmkzfUDsA4JkqEZR0AMLHFEckQFJYsJxCtj30ge4CbxTvGGaGfKXkcxlKyAKOm8xaiPOlgH5eK+Tpam/u0YUgQNQ1d8EzHKQkys+xplmNGGbGq11ARSZ3OH+npF1ulfd7GE8jmFaAmo5G9uotHSe4MD2GlAP/rW+QkwKAYYySfdyk6YkoLHHY4P+Rxfb3sLPzizXyatK9GCmcGjBDQEH9HjZFtJGN+r71BT39I8J66FDM7+XsRE0J8C2l8V4AZ4LKiN0w/9MtD+NMjk80iOsQn2T6utihqkWOknGzo5UsxcQNaiDT16iJQvuclh8sABYqeWtRg40jih6e8IfLAbblCHRbTZjfv9v3S+wvk/Ya2DdDzfNUdVCt3qGuR7q/94LCcuZyMZQppej5KM7Y46HA1WYuPmCj6XSttA9YJaVnTVHKgkFa9HUldYLRphK1gqGoGbOHeGoIOyatgq2JUqkQIJpu7NMfKSBa/2Sluu5acENequtnIS7dt1tnpdx7aNhiGTKXvOVw=
  - secure: ssrCtl2Y1WI6OCUZC6UpwXJj+MWHK6yfSlYu0Bc0XW36gPSrcVyoH3aB/Z+PAliLq8O22oQCHljozLiWSQAKQzrjjcUHqeyY0/T2nXOSeyGa4WJdu1WS/mbi252UxrAxlUuBcIb5OOUwBlNSkKUBRM2TsF4Zc37XAgxQX2b5Fgx00KxStACNaJoq/CGV107EKs+GUO1ZjCsz44JcXT52R9dWY4YaXcF5rLVJAHlPihvNeRPNtIPY48+ngQKds26ASBJ1NVRvzrWypcMyccWKS3JN39ciD/QVgRNEF0LiZ2v0pyYJoGUtowjlFgevt2NvCugQqxrwP7NpZbvSZ+wn+y3fDu+z/aYr8U7mEwb3z1uFAcj1i6To6jtXKrY2u/2rHoLPH5G3MHEK3+h3hw3BRWdZJ3n04FxUmH52eNN2deUX1GEO9MFtKQ+v4ibiXLpswI1+BgsfTBBrs4miFz5YjOLJpSgPbiB/onU4zZQ+e1kAPcG1tlQjR7Uv6RSQ0DVUTPZbJFY48TFXAg5rYgHU/icIW2aVMwHAFdziqvvPqkB/UkMy8aa90o77MI6wAfZFb5vp+iN3nUkhRJnAZvs6V2U0Y4K1aIUin5EKzTwdIcKHcC0hOXzKifBKIMhv5JHAk/VJPt58wHtngKOTNcnFMKiHwkyWnOtb1ZkXK8bPxI0=
  - secure: ZzU6QQtw3IMKfZm2qBUNEph6KCO8C6KZ3GtPB5XCLZFwI4IApv7lEsSnoKuZClgeYUk1QGXEgVn3CGv6XNL3AMnnfAa3znHZN6026uVyg16TAHmHuu33DNpc+W+FlH8itq90Ri0nUPo7myWgInjfIIEdwOuwYs9ULH0z7deYk5CW2ElR+mb/+9UsNlDNnD5bhHbvOXPTylD6NhfUPku74PLHyRN0KjsSXVUX0azQgiOX2jKmnDLqF8ELKra3YXLIaJ7awAIoDKJ8uBcNvQG1SetyEQuHwnyh/QpPgSx3/mx2guOqQ3e5CdO+rewHA02f2T63HNqOS6Sp9QzeBTwWLi7xSng6hyZYtQx9N24se8Rqj7E9SERa+JR6E+sDPy/d9JCa5OgPukuH4AXpwTUS0VifMyvfBdzrSfcIL+8zAOxi7g0ZYKGVapifotpoQMAZkoaIBa4g9z6nq44asWYV9n/xm+1MpQ/aNqzaUPj+//oFIW7lhzsPfY1CwfjCseB/vARm15ZnWgNvuFASeeAIbxIc5wS3S12xQjxwiHejz40hq5XSrCakR7Vl2EtN9m8uQnT7Jz8o98Yh2hgXYAAUj91fR+qLryOeOQcGdIsjkUeaEKKLx0fzVyFMhALVOG/gqfI/j8MaLYLl7k5rS95l25RoVUaw8cGh23zpa1xjAXc=

after_success: 
  - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
  - export REPO=$DOCKER_USER/ow-discord
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH; fi`
  - echo $REPO:$TAG:$COMMIT
  - docker build -f Dockerfile -t $REPO:$COMMIT .
  - docker tag $REPO:$COMMIT $REPO:$TAG
  - docker tag $REPO:$COMMIT $REPO:travis-$TRAVIS_BUILD_NUMBER
  - docker push $REPO