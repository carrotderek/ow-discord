language: node_js
node_js:
- '6'
cache:
  directories:
  - node_modules
env:
  global:
    secure: RPSMmMlyzVuOBz8I8oKduM/cXHOiVTEeo8GyyHT5AyLvlIQ9LHdAI3VYZ2ozHCgF8uNpJq8OzFLainyMCUZYKQhUGm09aJwDBorL7XMA999Bi0N5SPPoxLKDsaoiFATnhfBu8SyvMqyuKUtXAJoshBj2h0Q2PESJ9rbZLLY+MNAJS4WqFhAMZPiz3IP25mwQ/LJ+9Ks6h3MLDudrqG8V76USqwfDPFgR7pqbXZunxeaXuTw+FLYrdrtMNtl/WDI3MIEBoG0nvuru8fVb/kdzmntG4rXz+hCfXjcf0OE/aQa7Xw/c43nUpxF76sYjULfRKDyDi+f1BAqeQs9hP9PtbXWLsEuYYvCK9Qyj6mFbO+vq8vAgaBm6bcuxPgTU7ifZRqnBAArELiipt+6CDVJtZuB1fwcPncZ6q2UJYAnylkxlObqa+VNSrlsVedMMry0IMUvh8qxtyo1AuZgwJyh+uFmS/kqgCnTO1a+LYxL6jaayxyHmwPrBQjuRquhOjJ270GGsaMgEYBZUrENntFzHwx+a5GqZ9QJxOC+O09DGuK+WC531o6ptCRhEgaQlSzbIX8zlLv3BN3eZgg4UE7QzZNW5roeK+hF+Q2n/srOnICpd6W71/kU1IP8S2YGBObNTxmPTXw/0/VsF/aAhMVkSzPY+elV4en9Hpa1ZLL6w1RU=
    DOCKER_USER:
      secure: J5owt5JbmtLkdedjKG9y4bQet+KA/YObWTo6xC4Urg0M9EWWrdO+OKcZpw+qk9yNsEFCofiEqT4w8u6z9Y7ZDLBzLvRMEvqgqeNSLk/taYLUhZVcB0f8r8gqEHrag6BP1Y+7jwmF93+HCp7q3COqWghawOfR3oQadvgUWv7SHhjezaqj8yobCGo6bALqYPQ4e5f3F3ti2I1nJ9zHEqlXpwwvJr7NBwO3ljr8HAet1vFtVc8ltYS9SE0kuxthcs2z3GOmU6nHAccygFgBrBMRfvn78FjLGugoJT4TVtiEH9hg8C9Ez6IAdUWDlqVZaY3HxoXQQOZ3tbiT7uJ5qnPLVIEcWWOqoEKXRRW/RdMZSpiTzHGGf5PaXDaZwYFMpzX2RVSFOq36nuLlKwtGXvKVDYgFAJ4N8uz6H87DJlWdvfzA3gJbUYtGkymoQFMjQ+oMCJXFLmc2ztK3UKUp/xJFi+03pub3jCB4/eedweqLTx7s2+F4RQeR8rG4jQjgYmrUg9VafytKAkq0JsRFMRk3n0SPUyBjHjfZEfAYDWI2hI9Nn5NKudmBbKxUcvLvZNK1dlW6svmtiOUQpr9cu+Yv1q03pdiFYSQYTjXS8kAC4zKGHHy0QS2zGyEaHLKlVdhiZWmmum/4iDUD8vp+uxIHbCF2wnBvuDCver5LaftbK2w=
    DOCKER_PASS:
      secure: rl/Ai3O4ayWm5Yc7XH/4u2RrImk1Bwi06/2VVtkh3RiiWJu2BZvU0dBv1Z0Poc4vTFL4pi8I+wp+367L8UtrDE5I0Qmq2Q9hIBj1aZJbZH5830bNnMicxvYNFMsaEYPAzpHt1GCImPmpot1qX6VCKD04pXH4bkmg0F2PnoAycGwpmxBOqFczLnYt6cobTJtpiu3dAA0JnC06wB+l0fotl9qxN+496BUOFquRdTwH15DT5dSQuSaOwD1LTnwXZofotRjc/ZjCEVUa65M6RFhYHLYm/V7vQUYBkz/Da9h0TD7LraC2VES1f+I39h2VkoAwNE4dT5uM23vxdgo1FUSFvKoeeQZcR7+S33sffImZCgtYTXCSvxEaxN2mYoVMGYF5vi9Agn2tigCeNGFAG0kdxZN2TBzh4oNyC0sFhfoOon9copluGnJ0THf0pHxJ6sMDpp78FiOyjmOowHZUAPtMtrLyGKw8wT4fOsPTFb0smGtwTZTPVepfEn9Vlj52JfTsuj7DclxBCW6IRnvuW68ihd5+BG0VgYuUH9bk4gT6J8SsBEgEGyqEFk8P5gV41e448ZMUmfvum2qbwelJJ2a2vKXyLkZlCi9rYC9U5jhZBZOfcgEuUMlCyYfQpgiaw4EaYydDRSyxTGOBrMyZ1e7I8DVIABW+I/2+McUo6pkv0K8=
    DOCKER_EMAIL:
      secure: XX+gExxuUIvhCkKCBuUmXO8zr9L9a2Ue7b/Qbxek0OtE9PbOoGVZ61vDh9aF+3Wij5Z6cyrBu5ymXFAurnVpgjQ2m94ag/9XZ6yMs7XMFgwO1KqkxCBm1Qk+v7SCWGXvFS8iqjLoW/Vle6CuE7nmaQxP+odREHOi31wXWTNnX+reiSu0Zp0LG3vmJJsg2ZjSQaNokmfeeH2+cyvxv8S/BCJ/tBL4rDZ5kHdPzcO4Tb+TTa+JbY+QGs7ByLKzCcnKo5X5tXcXukFRSj9hRRFx5ZDLQ9QuoCqEcQD65h+/GeKWLujarlOhPKu5ss+hN22gxPbw8ytYNFcHJh5lX9aG9+B6blugeRJXNT53iOaY3GS0dTgEBr5R8MKXH4eIYiF3TktJXCfiWTnGFGWYvJBHqTTjPDVtWspGp9cFBZT5FG/9jay9w4uTmU9D7yxjv0lBrE2+87JBvO8OK0eSonImN8L7NtlWl5O+k5KxSKUfTriyF6XCsK9z2xsXFOe8sKoShQP/oZWFzSEt/JB6fWDGxM3xVM/5Di6mHzs31rBAtgyOLdOA7PFRyGSEDMPLUjSVVULsKYR/mhwkTadcwkcX16pKC/w6ZoAQxOMqdDe+sbX4hE6a7kpL1GUGetUFg2O8vOjWJIAXkWd9H8GcDsDuymBMhWQsoZlBaT/JJ3YolKU=
    - COMMIT=${TRAVIS_COMMIT::6}


after_success:
  — docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
  — export REPO=$DOCKER_USER/k-auth
  — export TAG=`if [ “$TRAVIS_BRANCH” == “master” ]; then echo “latest”; else echo $TRAVIS_BRANCH ; fi`
  — echo $REPO:$TAG:$COMMIT
  — docker build -f Dockerfile -t $REPO:$COMMIT .
  — docker tag $REPO:$COMMIT $REPO:$TAG
  — docker tag $REPO:$COMMIT $REPO:travis-$TRAVIS_BUILD_NUMBER
  — docker push $REPO